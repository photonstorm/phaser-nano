/* Phaser-Micro v1.0.0 (C) Copyright 2015 Photon Storm Ltd. */
(function(){var a=this,b=b||{};return b.VERSION="1.0.0",b.BLEND_NORMAL=0,b.BLEND_ADD=1,b.BLEND_MULTIPLY=2,b.BLEND_SCREEN=3,b.LINEAR=0,b.NEAREST=1,b.TINT=[16777215,16777215,16777215,16777215],b.PI_2=2*Math.PI,b.RAD_TO_DEG=180/Math.PI,b.DEG_TO_RAD=Math.PI/180,b.Game=function(a,b,c,d,e){this.parent=d||"",this.width=a||800,this.height=b||600,this.isBooted=!1,this.canvas=null,this.context=null,this.state=e,this.pixelArt=!1,this.cache=null,this.load=null,this.renderer=null,this.children=[],this.boot()},b.Game.prototype={boot:function(){if(!this.isBooted){var a=this.boot.bind(this);"complete"===document.readyState||"interactive"===document.readyState?document.body?(document.removeEventListener("deviceready",a),document.removeEventListener("DOMContentLoaded",a),window.removeEventListener("load",a),this.isBooted=!0,this.init()):window.setTimeout(a,20):(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1))}},init:function(){this.showHeader(),this.cache=new b.Cache(this),this.load=new b.Loader(this),this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.renderer=new b.WebGL(this),this.renderer.boot(),this.addToDOM(),this.state.preload?(this.state.preload.call(this.state,this),0===this.load._totalFileCount?this.start():this.load.start()):this.start()},showHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var a=b.VERSION,c=["%c %c %c %c %c  PhaserMicro v"+a+" - http://phaser.io  ","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #ffffff; background: #000;"];console.log.apply(console,c)}},start:function(){this.state.create&&this.state.create.call(this.state,this),window.requestAnimationFrame(this.update.bind(this))},update:function(){this.state.update&&this.state.update.call(this.state,this),this.renderer.render(),window.requestAnimationFrame(this.update.bind(this))},addToDOM:function(){var a;this.parent&&("string"==typeof this.parent?a=document.getElementById(this.parent):"object"==typeof this.parent&&1===this.parent.nodeType&&(a=this.parent)),a||(a=document.body),a.appendChild(this.canvas)},addChild:function(a,c,d,e){var f=new b.Sprite(this,a,c,d,e);return f.parent=this.renderer,this.children.push(f),f}},b.WebGL=function(a){this.game=a,this.canvas=a.canvas,this.gl=null,this.frameCount=0,this.contextOptions={alpha:!1,antialias:!0,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1},this.worldAlpha=1,this.worldTransform=new b.Matrix,this.contextLost=!1,this.projection={x:0,y:0},this.vertSize=6,this.batchSize=2e3,this.stride=4*this.vertSize,this.vertices=new Float32Array(4*this.batchSize*this.vertSize),this.indices=new Uint16Array(6*this.batchSize),this._blitMatrix=new b.Matrix,this._size=0,this._batch=[],this._base=null,this.dirty=!0},b.WebGL.prototype={boot:function(){this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.canvas.addEventListener("webglcontextlost",this.contextLostBound,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoredBound,!1);var a=this.canvas.getContext("webgl",this.contextOptions)||this.canvas.getContext("experimental-webgl",this.contextOptions);if(this.gl=a,!a)throw new Error("Browser does not support WebGL");a.id=0,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),a.enable(a.BLEND),this.gl.viewport(0,0,this.game.width,this.game.height),this.projection.x=this.game.width/2,this.projection.y=-this.game.height/2;for(var b=0,c=0;b<6*this.batchSize;b+=6,c+=4)this.indices[b+0]=c+0,this.indices[b+1]=c+1,this.indices[b+2]=c+2,this.indices[b+3]=c+0,this.indices[b+4]=c+2,this.indices[b+5]=c+3;this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.initShader()},initShader:function(){var a=this.gl,c=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4((aVertexPosition / projectionVector) + center, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y / 65536.0, aColor.y / 256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],d=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"],e=this.compileShader(d,a.FRAGMENT_SHADER),f=this.compileShader(c,a.VERTEX_SHADER),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)?(a.useProgram(g),this.aVertexPosition=a.getAttribLocation(g,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(g,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(g,"aColor"),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),this.projectionVector=a.getUniformLocation(g,"projectionVector"),!0):(b.log("Could not initialise shaders"),!1)},compileShader:function(a,b){var c=this.gl,a=a.join("\n"),d=c.createShader(b);return c.shaderSource(d,a),c.compileShader(d),c.getShaderParameter(d,c.COMPILE_STATUS)?d:null},render:function(){if(!this.contextLost){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT),this._size=0,this._batch=[],this.dirty=!0;for(var b,c=0;c<this.game.children.length;c++)b=this.game.children[c],b.updateTransform(),b.visible&&b.worldAlpha>0&&this.renderSprite(b);this.game.state.render&&this.game.state.render.call(this.game.state,this),this.flush()}},blit:function(a,c,d){this._size>=this.batchSize&&(this.flush(),this._base=d.baseTexture);var e=1,f=d.frame.width,g=d.frame.width,h=d.frame.height,i=d.frame.height;this._blitMatrix.set(1,0,0,1,a,c),this.addVerts(d.uvs,this._blitMatrix,f,h,g,i,e,b.TINT),this._batch[this._size++]=d},renderSprite:function(a){var b=a.texture;this._size>=this.batchSize&&(this.flush(),this._base=b.baseTexture);var c,d,e,f,g=a.anchor.x,h=a.anchor.y;b.frame.trimmed?(d=b.frame.trimX-g*b.frame.trimWidth,c=d+b.cropWidth,f=b.frame.trimY-h*b.frame.trimHeight,e=f+b.cropHeight):(c=b.cropWidth*(1-g),d=b.cropWidth*-g,e=b.cropHeight*(1-h),f=b.cropHeight*-h),this.addVerts(b.uvs,a.worldTransform,c,e,d,f,a.worldAlpha,a.tint),this._batch[this._size++]=b},addVerts:function(a,b,c,d,e,f,g,h){var i=b.a,j=b.b,k=b.c,l=b.d,m=b.tx,n=b.ty,o=this.vertices,p=4*this._size*this.vertSize;o[p++]=i*e+k*f+m,o[p++]=l*f+j*e+n,o[p++]=a.x0,o[p++]=a.y0,o[p++]=g,o[p++]=h[0],o[p++]=i*c+k*f+m,o[p++]=l*f+j*c+n,o[p++]=a.x1,o[p++]=a.y1,o[p++]=g,o[p++]=h[1],o[p++]=i*c+k*d+m,o[p++]=l*d+j*c+n,o[p++]=a.x2,o[p++]=a.y2,o[p++]=g,o[p++]=h[2],o[p++]=i*e+k*d+m,o[p++]=l*d+j*e+n,o[p++]=a.x3,o[p++]=a.y3,o[p++]=g,o[p++]=h[3]},flush:function(){if(0!==this._size){var a=this.gl;if(this.dirty&&(this.dirty=!1,a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.uniform2f(this.projectionVector,this.projection.x,this.projection.y),a.vertexAttribPointer(this.aVertexPosition,2,a.FLOAT,!1,this.stride,0),a.vertexAttribPointer(this.aTextureCoord,2,a.FLOAT,!1,this.stride,8),a.vertexAttribPointer(this.colorAttribute,2,a.FLOAT,!1,this.stride,16)),this._size>.5*this.batchSize)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var c=this.vertices.subarray(0,4*this._size*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}for(var d=0,e=0,f={source:null},g=null,h=-1,i=null,j=0;j<this._size;j++)g=this._batch[j].baseTexture,i=this._batch[j].blendMode,h!==i&&(i===b.BLEND_NORMAL?a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA):i===b.BLEND_ADD?a.blendFunc(a.SRC_ALPHA,a.DST_ALPHA):i===b.BLEND_MULTIPLY?a.blendFunc(a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA):i===b.BLEND_SCREEN&&a.blendFunc(a.SRC_ALPHA,a.ONE)),f.source!==g.source&&(e>0&&(a.bindTexture(a.TEXTURE_2D,f._gl[a.id]),a.drawElements(a.TRIANGLES,6*e,a.UNSIGNED_SHORT,6*d*2)),d=j,e=0,f=g),e++;e>0&&(a.bindTexture(a.TEXTURE_2D,f._gl[a.id]),a.drawElements(a.TRIANGLES,6*e,a.UNSIGNED_SHORT,6*d*2)),this._size=0}},unloadTexture:function(a){for(var b=a._gl.length-1;b>=0;b--){var c=a._gl[b];this.gl&&c&&this.gl.deleteTexture(c)}a._gl.length=0,a.dirty()},loadTexture:function(a){var b=this.gl;a._gl[b.id]||(a._gl[b.id]=b.createTexture()),b.bindTexture(b.TEXTURE_2D,a._gl[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),a.scaleMode?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR)),a._pot?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),a._dirty[b.id]=!1},handleContextLost:function(a){a.preventDefault(),this.contextLost=!0},handleContextRestored:function(){this.boot(),this.contextLost=!1}},b.Canvas=function(a){this.game=a,this.canvas=a.canvas,this.context=null,this.width=a.width,this.height=a.height,this.smoothProperty=null,this.worldAlpha=1,this.worldTransform=new b.Matrix},b.Canvas.prototype={boot:function(){this.context=this.canvas.getContext("2d",{alpha:!1}),this.smoothProperty=this.getSmoothingPrefix()},render:function(){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation="source-over",this.context.fillStyle="#000",this.context.fillRect(0,0,this.width,this.height);for(var a,b=0;b<this.game.children.length;b++)a=this.game.children[b],a.updateTransform(),a.visible&&a.worldAlpha>0&&this.renderSprite(a);this.game.state.render&&this.game.state.render.call(this.game.state,this)},blit:function(a,c,d){this.game.pixelArt,this.context.setTransform(1,0,0,1,a,c);var e=d.frame;this.context[this.smoothProperty]=d.baseTexture.scaleMode===b.LINEAR||!this.game.pixelArt;var f=-d.frame.width,g=-d.frame.height;this.context.drawImage(d.baseTexture.source,e.x,e.y,e.width,e.height,f,g,e.width,e.height)},renderSprite:function(a){this.context.globalAlpha=a.worldAlpha;var c=a.worldTransform,d=c.tx,e=c.ty;this.game.pixelArt,this.context.setTransform(c.a,c.b,c.c,c.d,d,e);var f=a.texture,g=f.frame;this.context[this.smoothProperty]=f.baseTexture.scaleMode===b.LINEAR||!this.game.pixelArt;var h,i;g.trimmed?(h=g.trimX-a.anchor.x*f.cropWidth,i=g.trimY-a.anchor.y*f.cropHeight):(h=a.anchor.x*-g.width,i=a.anchor.y*-g.height),this.context.drawImage(f.baseTexture.source,f.cropX,f.cropY,f.cropWidth,f.cropHeight,h,i,f.cropWidth,f.cropHeight)},loadTexture:function(a){},getSmoothingPrefix:function(){var a=["i","webkitI","msI","mozI","oI"];for(var b in a){var c=a[b]+"mageSmoothingEnabled";if(c in this.context)return c}return null}},b.Loader=function(a){this.game=a,this.cache=a.cache,this.baseURL="",this.path="",this.isLoading=!1,this.hasLoaded=!1,this._list=[],this._queue=[],this._started=!1,this._total=0,this._processingHead=0},b.Loader.prototype={reset:function(){this.isLoading=!1,this.hasLoaded=!1,this._list.length=0,this._queue.length=0,this._started=!1,this._total=0,this._processingHead=0},addToFileList:function(a,b,c,d,e){if(void 0===b||""===b)return console.warn("Phaser.Loader: Invalid or no key given of type "+a),this;if(void 0===c||null===c){if(!e)return console.warn("Phaser.Loader: No URL given for file type: "+a+" key: "+b),this;c=b+e}var f={type:a,key:b,path:this.path,url:c,data:null,loading:!1,loaded:!1,error:!1};if(d)for(var g in d)f[g]=d[g];return this._list.push(f),this._total++,this},image:function(a,b){return this.addToFileList("image",a,b,void 0,".png")},spritesheet:function(a,b,c,d,e,f,g){return void 0===e&&(e=-1),void 0===f&&(f=0),void 0===g&&(g=0),this.addToFileList("spritesheet",a,b,{width:c,height:d,max:e,margin:f,spacing:g},".png")},atlas:function(a,b,c,d){return b||(b=a+".png"),c||d||(c=a+".json"),"string"==typeof d&&(d=JSON.parse(d),c=null),this.addToFileList("textureatlas",a,b,{atlasURL:c,atlasData:d}),this},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this._processingHead=0,this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var a=0;a<this._queue.length;a++){var c=this._queue[a];(c.loaded||c.error)&&(this._queue.splice(a,1),a--,c.loading=!1,c.requestUrl=null,c.requestObject=null,c.error&&b.log("File loading error"+c.key),this._loadedFileCount++)}for(var a=this._processingHead;a<this._list.length;a++){var c=this._list[a];if(c.loaded||c.error?a===this._processingHead&&(this._processingHead=a+1):!c.loading&&this._queue.length<4&&(this._started||(this._started=!0),this._queue.push(c),c.loading=!0,this.loadFile(c)),this._queue.length>=4)break}if(this._processingHead>=this._list.length)this.finishedLoading();else if(!this._queue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var d=this;setTimeout(function(){d.finishedLoading(!0)},2e3)}},loadFile:function(a){switch(a.type){case"image":case"spritesheet":case"textureatlas":this.loadImageTag(a)}},loadImageTag:function(a){var b=this;a.data=new Image,a.data.name=a.key,this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin),a.data.onload=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,b.fileComplete(a))},a.data.src=this.transformUrl(a.url,a),a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,this.fileComplete(a))},transformUrl:function(a,b){return a?a.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?a:this.baseURL+b.path+a:!1},fileComplete:function(a,b){var c=!0;switch(a.type){case"image":this.cache.addImage(a.key,a.url,a.data);break;case"spritesheet":this.cache.addImage(a.key,a.url,a.data,a.width,a.height,a.max,a.margin,a.spacing);break;case"textureatlas":a.atlasURL?(c=!1,this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.jsonLoadComplete)):this.cache.addTextureAtlas(a.key,a.url,a.data,a.atlasData)}c&&this.asyncComplete(a)},xhrLoad:function(a,b,c,d,e){var f=new XMLHttpRequest;f.open("GET",b,!0),f.responseType=c,e=e||this.fileError;var g=this;f.onload=function(){try{return d.call(g,a,f)}catch(b){g.hasLoaded?window.console&&console.error(b):g.asyncComplete(a,b.message||"Exception")}},f.onerror=function(){try{return e.call(g,a,f)}catch(b){g.hasLoaded?window.console&&console.error(b):g.asyncComplete(a,b.message||"Exception")}},a.requestObject=f,a.requestUrl=b,f.send()},jsonLoadComplete:function(a,b){var c=JSON.parse(b.responseText);"json"===a.type?this.cache.addJSON(a.key,a.url,c):this.cache.addTextureAtlas(a.key,a.url,a.data,c),this.asyncComplete(a)},asyncComplete:function(a,b){void 0===b&&(b=""),a.loaded=!0,a.error=!!b,b&&(a.errorMessage=b,console.warn("Phaser.Loader - "+a.type+"["+a.key+"]: "+b)),this.processLoadQueue()},finishedLoading:function(a){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,a||this._started||(this._started=!0),this.reset(),this.game.start())}},b.Cache=function(a){this.game=a,this._cache={image:{}}},b.Cache.prototype={addImage:function(a,c,d,e,f,g,h,i){var j=new b.FrameData;void 0!==e?this.buildSheet(j,d,e,f,g,h,i):j.addFrame(0,0,d.width,d.height,a),this.addImageEntry(a,c,d,j)},addImageEntry:function(a,c,d,e){var f={key:a,url:c,data:d,base:new b.BaseTexture(d,e)};this.game.pixelArt&&(f.base.scaleMode=1),this.game.renderer.loadTexture(f.base),this._cache.image[a]=f},addTextureAtlas:function(a,c,d,e){if(!e.frames)return void console.warn("Invalid Atlas JSON");var f=d.width,g=d.height,h=new b.FrameData;if(Array.isArray(e.frames))for(var i=0;i<e.frames.length;i++)h.add(e.frames[i],f,g,e.frames[i].filename);else for(var j in e.frames)h.add(e.frames[j],f,g,j);this.addImageEntry(a,c,d,h)},buildSheet:function(a,b,c,d,e,f,g){var h=b.width,i=b.height;0>=c&&(c=Math.floor(-h/Math.min(-1,c))),0>=d&&(d=Math.floor(-i/Math.min(-1,d)));var j=Math.floor((h-f)/(c+g)),k=Math.floor((i-f)/(d+g)),l=j*k;if(-1!==e&&(l=e),!(0===h||0===i||c>h||d>i||0===l))for(var m=f,n=f,o=0;l>o;o++)a.addFrame(m,n,c,d),m+=c+g,m+c>h&&(m=f,n+=d+g)},getTexture:function(a){return this._cache.image[a]?this._cache.image[a].base:void console.warn("No texture found matching key",a)},getImage:function(a,b){var c=this._cache.image[a];return b?c:c.data}},b.Texture=function(a,c){void 0===c&&(c=0),this.baseTexture=a,this.blendMode=b.BLEND_NORMAL,this.frame=this.baseTexture.frameData.getFrame(c),this._crop={x:this.frame.x,y:this.frame.y,width:this.frame.width,height:this.frame.height},this._isCropped=!1,this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.updateUVs()},b.Texture.prototype={resetCrop:function(){this._isCropped=!1,this.updateFrame()},updateFrame:function(){this._isCropped||(this._crop.x=this.frame.x,this._crop.y=this.frame.y,this._crop.width=this.frame.width,this._crop.height=this.frame.height),this.updateUVs()},setFrame:function(a){this.frame=this.baseTexture.frameData.getFrame(a),this.updateFrame()},setFrameByIndex:function(a){this.frame=this.baseTexture.frameData.getFrameIndex(a),this.updateFrame()},setFrameByName:function(a){this.frame=this.baseTexture.frameData.getFrameName(a),this.updateFrame()},updateUVs:function(){var a=this.baseTexture.width,b=this.baseTexture.height;this.uvs.x0=this.cropX/a,this.uvs.y0=this.cropY/b,this.uvs.x1=(this.cropX+this.cropWidth)/a,this.uvs.y1=this.cropY/b,this.uvs.x2=(this.cropX+this.cropWidth)/a,this.uvs.y2=(this.cropY+this.cropHeight)/b,this.uvs.x3=this.cropX/a,this.uvs.y3=(this.cropY+this.cropHeight)/b}},Object.defineProperties(b.Texture.prototype,{width:{get:function(){return this.frame.sourceWidth}},height:{get:function(){return this.frame.sourceHeight}},cropX:{get:function(){return this._crop.x},set:function(a){this._crop.x=a,this._isCropped=!0,this.updateUVs()}},cropY:{get:function(){return this._crop.y},set:function(a){this._crop.y=a,this._isCropped=!0,this.updateUVs()}},cropWidth:{get:function(){return this._crop.width},set:function(a){this._crop.width=a,this._isCropped=!0,this.updateUVs()}},cropHeight:{get:function(){return this._crop.height},set:function(a){this._crop.height=a,this._isCropped=!0,this.updateUVs()}}}),b.BaseTexture=function(a,c){this.source=a,this.width=a.width,this.height=a.height,this.frameData=c,this.scaleMode=b.LINEAR,this.premultipliedAlpha=!0,this._gl=[],this._pot=!1,this._dirty=[!0,!0,!0,!0]},b.BaseTexture.prototype={dirty:function(){for(var a=0;a<this._glTextures.length;a++)this._dirty[a]=!0}},b.Sprite=function(a,c,d,e,f){this.game=a,this.position=new b.Point(c,d),this.scale=new b.Point(1,1),this.anchor=new b.Point,this.pivot=new b.Point,this.rotation=0,this.alive=!0,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.alpha=1,this.worldTransform=new b.Matrix,this.tint=[16777215,16777215,16777215,16777215],this.texture=new b.Texture(a.cache.getTexture(e),f),this._width=this.texture.width,this._height=this.texture.height,this._rot=0,this._sr=0,this._cr=1},b.Sprite.prototype={updateTransform:function(){var a=this.parent.worldTransform,c=this.worldTransform,d=this.scale.x,e=this.scale.y,f=this.position.x-this.pivot.x*d,g=this.position.y-this.pivot.y*e;if(this.rotation%b.PI_2){this.rotation!==this._rot&&(this._rot=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),d*=this._cr;var h=this._sr*this.scale.x,i=-this._sr*this.scale.y;e*=this._cr,f=this.position.x,g=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*d+this.pivot.y*i,g-=this.pivot.x*h+this.pivot.y*e),c.a=d*a.a+h*a.c,c.b=d*a.b+h*a.d,c.c=i*a.a+e*a.c,c.d=i*a.b+e*a.d,c.tx=f*a.a+g*a.c+a.tx,c.ty=f*a.b+g*a.d+a.ty}else c.a=d*a.a,c.b=d*a.b,c.c=e*a.c,c.d=e*a.d,c.tx=f*a.a+g*a.c+a.tx,c.ty=f*a.b+g*a.d+a.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha}},b.Sprite.prototype.constructor=b.Sprite,Object.defineProperties(b.Sprite.prototype,{width:{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}},height:{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}},worldVisible:{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}},x:{get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a}},frame:{get:function(){return this.texture.frame.index},set:function(a){this.texture.setFrameByIndex(a)}},frameName:{get:function(){return this.texture.frame.name},set:function(a){this.texture.setFrameByName(a)}},blendMode:{get:function(){return this.texture.blendMode},set:function(a){this.texture.blendMode=a}}}),b.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},b.Matrix.prototype={set:function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this}},b.Rectangle=function(a,b,c,d){a=a||0,b=b||0,c=c||0,d=d||0,this.x=a,this.y=b,this.width=c,this.height=d},b.Rectangle.prototype={copyFrom:function(a){this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height},clone:function(){return new b.Rectangle(this.x,this.y,this.width,this.height)}},b.Point=function(a,b){a=a||0,b=b||0,this.x=a,this.y=b},b.Point.prototype={set:function(a,b){return this.x=a||0,this.y=b||(0!==b?this.x:0),this}},b.Group=function(a){this.game=a,this.children=[]},b.Group.prototype={add:function(a){return this.addAt(a,this.children.length)},addAt:function(a,b){return this.children.splice(b,0,a),a},swap:function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);return 0>c||0>d?!1:(this.children[c]=b,this.children[d]=a,!0)}},getIndex:function(a){return this.children.indexOf(a)},getAt:function(a){return 0>a||a>=this.children.length?!1:this.children[a]},remove:function(a){var b=this.children.indexOf(a);return-1!==b?this.removeAt(b):void 0},removeAt:function(a){var b=this.getAt(a);return b&&this.children.splice(a,1),b},bringToTop:function(a){return this.getIndex(a)<this.children.length&&(this.remove(a),this.add(a)),a},sendToBack:function(a){return this.getIndex(a)>0&&(this.remove(a),this.addAt(a,0)),a},moveUp:function(a){var b=this.getIndex(a);if(b<this.children.length-1){var c=this.getAt(b+1);c&&this.swap(a,c)}return a},moveDown:function(a){var b=this.getIndex(a);if(b>0){var c=this.getAt(b-1);c&&this.swap(a,c)}return a},filter:function(a,b){for(var c=-1,d=this.children.length,e=[];++c<d;){var f=this.children[c];a.call(b,f)&&e.push(f)}return e},forEach:function(a,b){if(arguments.length<=2)for(var c=0;c<this.children.length;c++)a.call(b,this.children[c]);else{for(var d=[null],c=2;c<arguments.length;c++)d.push(arguments[c]);for(var c=0;c<this.children.length;c++)d[0]=this.children[c],a.apply(b,d)}},iterate:function(a,b,c,d,e,f){for(var g=0,h=0;h<this.children.length;h++)if(this.children[h][a]===b&&(g++,d&&(f?(f[0]=this.children[h],d.apply(e,f)):d.call(e,this.children[h])),c))return this.children[h];return c?null:g},getFirstAlive:function(){return this.iterate("alive",!0,!0)},getFirstDead:function(){return this.iterate("alive",!1,!0)}},b.Frame=function(a,b,c,d,e,f){this.index=a,this.x=b,this.y=c,this.width=d,this.height=e,this.name=f||"",this.rotation=0,this.sourceWidth=d,this.sourceHeight=e,this.trimmed=!1,this.trimX=0,this.trimY=0,this.trimWidth=0,this.trimHeight=0},b.Frame.prototype={setTrim:function(a,b,c,d,e,f){this.trimmed=!0,this.sourceWidth=a,this.sourceHeight=b,this.trimX=c,this.trimY=d,this.trimWidth=e,this.trimHeight=f},setRotation:function(a){"cw"===a?this.rotation=90:"ccw"===a&&(this.rotation=-90)}},b.Frame.prototype.constructor=b.Frame,b.FrameData=function(){this._frames=[],this._indexes=[],this._names={}},b.FrameData.prototype={addFrame:function(a,c,d,e,f){var g=this._frames.length,h=new b.Frame(g,a,c,d,e,f);return this._frames.push(h),this._indexes.push(this._frames[g]),f&&(this._names[f]=this._frames[g]),h},add:function(a,b,c,d){var e=a.frame,f=this.addFrame(e.x,e.y,e.w,e.h,d);if(a.trimmed){var g=a.spriteSourceSize;f.setTrim(a.sourceSize.w,a.sourceSize.h,g.x,g.y,g.w,g.h)}},getFrame:function(a){return"number"==typeof a?this._indexes[a]:this._names[a]},getFrameIndex:function(a){return this._indexes[a]},getFrameName:function(a){return this._names[a]}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PhaserMicro=b):"undefined"!=typeof define&&define.amd?define("PhaserMicro",function(){return a.PhaserMicro=b}()):a.PhaserMicro=b,b}).call(this);